@using SostavSD.Areas.Identity.Constants;
@inject ISnackbar Snackbar
@inject IStringLocalizer<CompanyListTable> localizer


<MudContainer Class="d-flex justify-center mb-sm-5">
    <AuthorizeView Roles="@Roles.SeveralRoles(Roles.Chief, Roles.Secretary)">
        <MudFab Color="Color.Primary" Icon="@Icons.Material.Filled.Add" Size="Size.Small" Label="@localizer["newCompany"]" @onclick="(e => CreateNewCompany())"/>
    </AuthorizeView>
    
</MudContainer>
    <MudIconButton Icon="@Icons.Custom.FileFormats.FileExcel" Size="Size.Large" Color="Color.Tertiary" @onclick="ExportToExcel"></MudIconButton>
    <MudIconButton Icon="@Icons.Custom.FileFormats.FileWord" Size="Size.Large"  Color="Color.Info" @onclick="ExportToWord"></MudIconButton>
    <MudIconButton Icon="@Icons.Custom.FileFormats.FilePdf" Size="Size.Large"  Color="Color.Secondary" @onclick="ExportToPDF"></MudIconButton>
    <MudIconButton Class="ms-7" Icon="@Icons.Material.Filled.AttachEmail" Size="Size.Large"  Color="Color.Primary" @onclick="SendMail"></MudIconButton>
@if (showMailAlert)
{
  <MudAlert Severity="Severity.Success" ContentAlignment="HorizontalAlignment.Center" ShowCloseIcon="true" CloseIconClicked="(() => CloseMe(true))">@localizer["successMailMessage"] @_email </MudAlert>
}
<MudSelect T="CompanyModel" Label="@localizer["Customer"]" Variant="Variant.Filled" AnchorOrigin="Origin.BottomCenter">

</MudSelect>

@if (_companies == null)
{
        <tr>@localizer["loadingdata"]</tr>
}
else if (_companies.Count == 0)
{
        <tr> @localizer["noitem"]</tr>
}
else
{
            <MudTable Items="@_companies" Filter="new Func<CompanyModel,bool>(FilterFuncCurrent)" @bind-SelectedItem="selectedItem">

            <ToolBarContent>
                <MudSpacer />
                <MudTextField @bind-Value="searchString" Placeholder="@localizer["Search"]" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
            </ToolBarContent>
            <HeaderContent >
                <MudTh>@localizer["companyName"]</MudTh>
                    <MudTh>@localizer["companyDetails"]</MudTh>
            </HeaderContent>

                <RowTemplate Context="tableRowContext">
                    <MudTd DataLabel="Name">@tableRowContext.CompanyName</MudTd>
                    <MudTd DataLabel="Details">@tableRowContext.CompanyDetails</MudTd>

                    <MudTd>
                         <AuthorizeView Roles="@Roles.SeveralRoles(Roles.Chief, Roles.Secretary)">
                            <MudFab @onclick="@(() => Edit(@tableRowContext.CompanyID))" Color="Color.Primary" Icon="@Icons.Material.Filled.Edit" Size="Size.Small" IconSize="Size.Small"/>
                            <MudFab @onclick="@(() => Delete(@tableRowContext.CompanyID))" Color="Color.Primary" Icon="@Icons.Material.Filled.Delete" Size="Size.Small" IconSize="Size.Small"/>
                        </AuthorizeView>
                    </MudTd>


            </RowTemplate>

            <PagerContent>
                <MudTablePager />
            </PagerContent>
        </MudTable>
}

